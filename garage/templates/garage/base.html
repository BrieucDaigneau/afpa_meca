<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="utf-8" />
	<title>{% block title %}AFPA Pôle Mécanique{% endblock %}</title>
	{% load static %}
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="shortcut icon" type="image/png" href="{% static 'garage/img/favicon.ico' %}"/>
	<link href="{% static 'garage/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" media="screen" href="{% static 'garage/css/base.css' %}" />
	<link href="{% static 'garage/css/style.css' %}" rel="stylesheet" type="text/css" />
	<link href={% block css %}{% endblock css %} rel="stylesheet"> 
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.7.3/themes/base/jquery-ui.css">	
	{% block head %}{% endblock head %}
</head>

<body>

	<div class="container-fluid">
		<div class="row">
			<div class="col-md-4" id="logo">
				<img src="{% static 'garage/img/logo_afpa2.png' %}"/>
			</div>
			<div class="col-md-4" id="title">
				<h1>Pôle Mécanique</h1>
			</div>
			<div class="col-md-4" id="logout">
				

					<img src="{% static 'garage/img/logo_logout.jpg' %}" width="30" height="30">
					<div class="userConected">Bonjour, {{ user.get_username }}</div>
					<a href="{% url 'garage:logout' %}" class=" deconection userConected mb-2">Déconnexion</a>
				


			</div>
		</div>
	</div>


	<div class='row'>
		<div class='col-md-12'>

			<nav class="navbar navbar-expand-lg " id="navbar">

				<!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
				 aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button> -->
				<button class="navbar-toggler hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
					&#9776;
				</button>

				<div class="collapse navbar-collapse navbar-toggleable-md" id="navbarSupportedContent">
					<div id="navbar-contain">
						<ul class="nav  navbar-nav mr-auto  pull-md-right">
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'garage:home' %}">Accueil</a>
							</li>
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'garage:customer-select' %}">Nouveau</a>
							</li>
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'garage:customers' %}">Clients</a>
							</li>
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'garage:vehicles' %}">Vehicules</a>
							</li>
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'garage:reparation-orders' %}">Ordres de réparations</a> 
							</li>
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li>
							<!-- <li class="nav-item">
								<a class="nav-link" href="#">Utilisateurs</a>
							</li>
							<li class="nav-item nav-link">
								<div class="separator_navbar">|</div>
							</li> -->
						</ul>
					</div>
				</div>

			</nav>

		</div>
	</div>


	<div class="container">
		<div class='row'>
			<div class="col-md-12">
				{% block content %}{% endblock %}
			</div>
		</div>
	</div>

	<div class='row'>
		<div class='col-md-12'>
			<footer class=" page-footer font-small">
				<div class="footer-copyright text-center py-3" id="footer">© 2018 Copyright
					<a href="https://www.afpa.fr/">Afpa.fr</a>
				</div>
			</footer>
		</div>
	</div>

	</div>





	<script src="{% static 'garage/js/jquery-slim.min.js' %}"></script>
	<script src="{% static 'garage/js/holder.min.js' %}"></script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
	<script>
		$("#id_zip_code").autocomplete({
			source: function (request, response) {
				$.ajax({  
					url: "https://geo.api.gouv.fr/communes?codePostal="+$("input[name='zip_code']").val(),  
					data: { q: request.term },
					dataType: "json",
					success: function (data) {
						var postcodes = [];
						response($.map(data, function (item) {
							// Ici on est obligé d'ajouter les CP dans un array pour ne pas avoir plusieurs fois le même
							if ($.inArray(item.codesPostaux, postcodes) == -1) {
								postcodes.push(item.codesPostaux);
								return { label: item.codesPostaux + " - " + item.nom, 
										nom: item.nom,
										value: item.codesPostaux
								};
							}
						}));
					}
				});
			},
			// On remplit aussi la ville
			select: function(event, ui) {
				$('#id_city').val(ui.item.nom);
			}
		});
		$("#id_city").autocomplete({
			source: function (request, response) {
				$.ajax({ 
					url: "https://geo.api.gouv.fr/communes?nom="+$("input[name='city']").val(),                
					data: { q: request.term },
					dataType: "json",
					success: function (data) {
						var cities = [];
						response($.map(data, function (item) {
							// Ici on est obligé d'ajouter les villes dans un array pour ne pas avoir plusieurs fois la même
							if ($.inArray(item.codesPostaux, cities) == -1) {
								cities.push(item.codesPostaux);
								return { label: item.codesPostaux + " - " + item.nom, 
								codesPostaux: item.codesPostaux,
										value: item.nom
								};
							}
						}));
					}
				});
			},
			// On remplit aussi le CP
			select: function(event, ui) {
				$('#id_zip_code').val(ui.item.codesPostaux);
			}
		});
		$("#id_street_name").autocomplete({
			source: function (request, response) {
				$.ajax({
					url: "https://api-adresse.data.gouv.fr/search/?postcode="+$("input[name='zip_code']").val(),
					data: { q: request.term },
					dataType: "json",
					success: function (data) {
						response($.map(data.features, function (item) {
							return { label: item.properties.name, value: item.properties.name};
						}));
					}
				});
			}
		});

		$(document).ready(function () {
			$("#navbar-contenu a").each(function (index) {
				if (this.href == document.location.href) {
					$(this).addClass('active');
				}
			})
		});
	</script>


</body>

</html>